設定window排程
1.將D:\Project\mqc_web\form內按樹狀結構壓縮所有子目錄及其中檔案
2.將壓縮檔命名為西元月份日期時間_MQC_FORM_IMG.zip ex.202403051200005_MQC_FORM_IMG.zip
3.將西元月份日期時間_MQC_FORM_IMG.zip儲存在D:\Project\mqc_web\Database\HIS
4.刪除D:\Project\mqc_web\form子資料夾內的檔案,要保留資料夾
5.每半小時執行一次

@echo off
setlocal

rem 檢查指定目錄是否有檔案
set "dir=D:\Project\mqc_web\form"
dir /a-d /b "%dir%\*" >nul 2>&1
if errorlevel 1 (
    echo No files found in %dir%.
    exit /b
)

rem 設定壓縮檔名
set "datetime=%date:~0,4%%date:~5,2%%date:~8,2%%time:~0,2%%time:~3,2%%time:~6,2%"
set "zipfile=D:\Project\mqc_web\Database\HIS\%datetime%_MQC_FORM_IMG.zip"

rem 壓縮檔案
"C:\Program Files\WinRAR\WinRAR.exe" a -afzip "%zipfile%" "%dir%"

rem 刪除子目錄內的檔案
for /d %%D in ("%dir%\*") do del /q "%%D\*"

endlocal

執行上述指令後%datetime%_MQC_FORM_IMG.zip解壓縮後的目錄結構如下:
Project-->mqc_web-->form--continue (可能含.csv or .txt檔案)
                        --rowdata (可能含.csv or .txt檔案)
                        --img (可能含.png檔案)
如何改成解壓縮後目錄結構為:
form--continue (可能含.csv or .txt檔案)
    --rowdata (可能含.csv or .txt檔案)
    --img (可能含.png檔案)



---------------------
@echo off
setlocal

rem 取得上一次壓縮檔案的日期和時間
for /f "tokens=1,2 delims=_" %%a in ('dir /b /od "D:\Project\mqc_web\Database\HIS\*_MQC_FORM_IMG.zip"') do (
    set "last_compressed_datetime=%%a_%%b"
)

rem 如果找不到上一次壓縮檔案，設置初始值為空
if not defined last_compressed_datetime set "last_compressed_datetime="

rem 顯示上一次壓縮檔案的日期和時間
echo Last compressed datetime: %last_compressed_datetime%

rem 設定壓縮檔名
set "datetime=%date:~0,4%%date:~5,2%%date:~8,2%%time:~0,2%%time:~3,2%%time:~6,2%"
set "zipfile=D:\Project\mqc_web\Database\HIS\%datetime%_MQC_FORM_IMG.zip"

rem 找出在上一次壓縮檔案之後新增的檔案並壓縮它們
forfiles /p "D:\Project\mqc_web\form" /s /m * /d +%last_compressed_datetime% /c "cmd /c if @isdir==FALSE \"C:\Program Files\WinRAR\WinRAR.exe\" a -afzip -ep1 \"%zipfile%\" @path"

endlocal

1.執行D:\Project\mqc_web\formcod資料夾內的download_mqc_rowdata_nopeak.py
2.執行D:\Project\mqc_web\formcod資料夾內的mqc_nopeak.py
3.將D:\Project\mqc_web\Database內的.zip檔案mput至ftp://tcftp001/ruby/
4.刪除D:\Project\mqc_web\Database內的.zip檔案

您可以使用 Windows 工作排程器來設定定期執行這些任務。以下是設定排程的步驟：

1. 打開「工作排程器」：在 Windows 搜尋欄中輸入「工作排程器」，然後點擊打開。

2. 創建新的工作：在右側的動作窗格中，點擊「建立基本工作」。

3. 命名和描述工作：在新出現的視窗中，輸入工作的名稱和描述，然後點擊「下一步」。

4. 選擇觸發器：選擇「每天」，並設定適當的開始時間，然後點擊「下一步」。

5. 選擇動作：選擇「啟動程式」，並在程式/腳本欄中分別輸入以下指令：

   - `python D:\Project\mqc_web\formcod\download_mqc_rowdata_nopeak.py` （第一個任務）
   - `python D:\Project\mqc_web\formcod\mqc_nopeak.py` （第二個任務）
   - `ftp -s:"D:\Project\mqc_web\Database\ftp_script.txt"` （第三個任務）
   - `del /Q D:\Project\mqc_web\Database\*.zip` （第四個任務）

6. 創建 ftp_script.txt 檔案，內容為：

   ```
   open tcftp001
   ruby
   mput D:\Project\mqc_web\Database\*.zip
   quit
   ```

7. 完成設定：檢查所有設定，確保沒有錯誤，然後點擊「完成」。

這樣就設定好了每天定時執行這些任務的排程。請注意，這僅供參考，您可能需要根據實際情況進行調整。



cd /d D:/Project/mqc_web/form/img
"C:\Program Files\WinRAR\WinRAR.exe" -afzip
D:/Project/mqc_web/Database/HIS/MQC_FORM_IMG.zip *.png
